# Build stage - compile TypeScript
FROM node:18-alpine AS builder

WORKDIR /app

# Copy package files and install dependencies
COPY package*.json ./
COPY tsconfig.frontend.json ./
RUN npm ci

# Copy and compile TypeScript
COPY script.ts ./
RUN npm run build:frontend

# Production stage - serve with nginx
FROM nginx:alpine

# Copy static files
COPY ui.html /usr/share/nginx/html/index.html
COPY styles.css /usr/share/nginx/html/styles.css
COPY nginx.conf /etc/nginx/conf.d/default.conf

# Copy compiled JavaScript from builder
COPY --from=builder /app/script.js /usr/share/nginx/html/script.js

EXPOSE 80
